/*
 * File:   main.c
 * Author: fano
 *
 * Created on 4 de noviembre de 2016, 0:52
 */

#pragma config PMDL1WAY = ON            // Peripheral Module Disable Configuration (Allow only one reconfiguration)
#pragma config IOL1WAY = ON             // Peripheral Pin Select Configuration (Allow only one reconfiguration)
#pragma config FUSBIDIO = OFF           // USB USID Selection (Controlled by Port Function)
#pragma config FVBUSONIO = OFF          // USB VBUS ON Selection (Controlled by Port Function)

// DEVCFG2
#pragma config FPLLIDIV = DIV_12        // PLL Input Divider (12x Divider)
#pragma config FPLLMUL = MUL_24         // PLL Multiplier (24x Multiplier)
#pragma config UPLLIDIV = DIV_12        // USB PLL Input Divider (12x Divider)
#pragma config UPLLEN = OFF             // USB PLL Enable (Disabled and Bypassed)
#pragma config FPLLODIV = DIV_256       // System PLL Output Clock Divider (PLL Divide by 256)

// DEVCFG1
#pragma config FNOSC = PRI              // Oscillator Selection Bits (Fast RC Osc (FRC))
#pragma config FSOSCEN = OFF            // Secondary Oscillator Enable (Disabled)
#pragma config IESO = OFF               // Internal/External Switch Over (Disabled)
#pragma config POSCMOD = HS            // Primary Oscillator Configuration (Primary osc disabled)
#pragma config OSCIOFNC = OFF           // CLKO Output Signal Active on the OSCO Pin (Disabled)
#pragma config FPBDIV = DIV_1           // Peripheral Clock Divisor (Pb_Clk is Sys_Clk/4)
#pragma config FCKSM = CSDCMD           // Clock Switching and Monitor Selection (Clock Switch Disable, FSCM Disabled)
#pragma config WDTPS = PS1048576        // Watchdog Timer Postscaler (1:1048576)
#pragma config WINDIS = OFF             // Watchdog Timer Window Enable (Watchdog Timer is in Non-Window Mode)
#pragma config FWDTEN = OFF             // Watchdog Timer Enable (WDT Disabled (SWDTEN Bit Controls))
#pragma config FWDTWINSZ = WINSZ_25     // Watchdog Timer Window Size (Window Size is 25%)

// DEVCFG0
#pragma config JTAGEN = ON              // JTAG Enable (JTAG Port Enabled)
#pragma config ICESEL = ICS_PGx1        // ICE/ICD Comm Channel Select (Communicate on PGEC1/PGED1)
#pragma config PWP = OFF                // Program Flash Write Protect (Disable)
#pragma config BWP = OFF                // Boot Flash Write Protect bit (Protection Disabled)
#pragma config CP = OFF                 // Code Protect (Protection Disabled)

#include "GPUCore/GPUCore.h"
#include <stdlib.h>
#include <xc.h>
#include <sys/attribs.h>

void __ISR (_EXTERNAL_0_VECTOR, IPL4AUTO) _DefaultInterrupt(void);

GPU gpu;
int dd;

void main(void) {
    volatile unsigned int int_status;

    int_status = __builtin_get_isr_state();
    __builtin_disable_interrupts();
    INTCONbits.INT0EP = 0;
    IEC0bits.INT0IE = 1;
    IPC0bits.INT0IP = 4;
    IFS0bits.INT0IF = 0;
    INTCONbits.INT0EP = 1;
    __builtin_set_isr_state(int_status);
    __builtin_enable_interrupts();
    
    gpu = GPU_new();
    
    uint8_t tilesMap[40][40] = {{2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {2, 2, 2, 2, 2, 2, 2, 2, 7, 2, 7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {2, 2, 2, 2, 2, 2, 2, 7, 2, 7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {3, 3, 3, 3, 3, 3, 3, 3, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 5, 3, 3, 3, 3, 3, 3, 3, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 3, 3, 3, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2}};

    uint8_t tiles[23][8][8] = {{{0xff, 0xf1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf1},
    {0xff, 0xff, 0xff, 0xff, 0x1f, 0xff, 0xff, 0xff},
    {0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf1},
    {0xff, 0xf1, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff}}
    ,{{0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22},
    {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22},
    {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22},
    {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22}}
    ,{{0x92, 0x22, 0x22, 0x22, 0x29, 0x22, 0x22, 0x22},
    {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22},
    {0x22, 0x22, 0x22, 0x22, 0x92, 0x22, 0x22, 0x22},
    {0x22, 0x92, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22}}
    ,{{0x22, 0x22, 0x22, 0x22, 0x22, 0x21, 0x22, 0x12},
    {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22},
    {0x22, 0x22, 0x22, 0x12, 0x22, 0x22, 0x22, 0x22},
    {0x22, 0x22, 0x12, 0x22, 0x22, 0x22, 0x22, 0x22}}
    ,{{0x43, 0x35, 0x55, 0x35, 0x43, 0x34, 0x33, 0x34},
    {0x43, 0x33, 0x53, 0x34, 0x53, 0x34, 0x43, 0x33},
    {0x43, 0x34, 0x43, 0x34, 0x43, 0x35, 0x55, 0x35},
    {0x33, 0x33, 0x33, 0x34, 0x43, 0x33, 0x53, 0x33}}
    ,{{0x6f, 0xe6, 0x6e, 0x6e, 0x6e, 0x66, 0x6f, 0xff},
    {0xf6, 0x66, 0x66, 0x6e, 0xe6, 0x6e, 0xf6, 0xf6},
    {0x66, 0x66, 0x6e, 0x66, 0xee, 0x6e, 0x66, 0x66},
    {0x6e, 0xee, 0x6e, 0xe6, 0xe6, 0xe6, 0xee, 0x6e}}
    ,{{0xef, 0xee, 0x6e, 0x6e, 0xe6, 0x66, 0x6e, 0x6f},
    {0xef, 0xfe, 0xef, 0xff, 0xef, 0xee, 0x66, 0x6f},
    {0xee, 0x66, 0xff, 0xff, 0xff, 0x66, 0xfe, 0x6f},
    {0xee, 0x66, 0x66, 0xf6, 0x66, 0x6e, 0x6e, 0xee}}
    ,{{0xee, 0xee, 0x66, 0x66, 0xf6, 0x6f, 0xf6, 0xef},
    {0xe6, 0xee, 0x6f, 0x66, 0xf6, 0x66, 0x66, 0x66},
    {0x66, 0xe6, 0xfe, 0x66, 0x66, 0x66, 0x66, 0xf6},
    {0x66, 0x66, 0x66, 0xe6, 0xe6, 0x6e, 0x6e, 0x6e}}
    ,{{0xe6, 0xe6, 0xee, 0x6e, 0x6e, 0xf6, 0xf6, 0xff},
    {0xff, 0x66, 0xe6, 0x6e, 0xe6, 0xee, 0x6e, 0xf6},
    {0x66, 0x6e, 0xef, 0xef, 0xef, 0x6e, 0xee, 0x6e},
    {0xee, 0xf6, 0xff, 0xf6, 0xf6, 0xf6, 0xe6, 0xee}}
    ,{{0x8f, 0xf8, 0x8f, 0xf7, 0x78, 0x78, 0xf7, 0xff},
    {0x8f, 0xf7, 0x77, 0x88, 0x77, 0x77, 0x88, 0x77},
    {0x77, 0x88, 0x77, 0x77, 0x87, 0x87, 0x7f, 0xf8},
    {0xff, 0x7f, 0x87, 0x87, 0x7f, 0xf8, 0x8f, 0xf8}}
    ,{{0x8f, 0xf8, 0x87, 0x78, 0x78, 0xf7, 0x8f, 0xf8},
    {0x8c, 0x77, 0x88, 0x77, 0x77, 0x88, 0x77, 0xf8},
    {0x8f, 0x77, 0x78, 0x87, 0x87, 0x78, 0x77, 0xf8},
    {0x8f, 0xf8, 0x7f, 0x87, 0x87, 0x78, 0x8f, 0xf8}}
    //
    ,{{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x0e, 0xe7, 0xe7, 0xe7},
    {0x00, 0x00, 0x00, 0xee, 0x7e, 0x77, 0x77, 0x77}}
    ,{{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x0e, 0xe7, 0xe7, 0xe7},
    {0x00, 0x00, 0x0e, 0xee, 0x7a, 0x77, 0x77, 0x77}}
    //
    ,{{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0xe7, 0xe7, 0xe7, 0x0e, 0x00, 0x00, 0x00, 0x00},
    {0x77, 0x77, 0x77, 0x7a, 0xee, 0x0e, 0x00, 0x00}}
    ,{{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0xe7, 0xe7, 0xe7, 0x0e, 0x00, 0x00, 0x00, 0x00},
    {0x77, 0x77, 0x77, 0x7e, 0xee, 0x00, 0x00, 0x00}}
    //
    ,{{0x00, 0x00, 0xee, 0xee, 0xee, 0x7e, 0x7e, 0x7e},
    {0x00, 0x00, 0x00, 0xee, 0xaa, 0xee, 0xaa, 0xaa},
    {0x00, 0x00, 0x00, 0xe0, 0xae, 0xa7, 0xaa, 0xaa},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0xee, 0xe7, 0xee}}
    ,{{0x00, 0xe0, 0xae, 0xa7, 0xa7, 0xa7, 0x77, 0x7e},
    {0x00, 0x00, 0xe0, 0xee, 0xee, 0xea, 0xea, 0xee},
    {0x00, 0x00, 0x00, 0x00, 0xee, 0xae, 0xae, 0xaa},
    {0x00, 0x00, 0x00, 0xee, 0xa7, 0xa7, 0xee, 0xee}}
    //
    ,{{0x7e, 0x77, 0xa7, 0xa7, 0xa7, 0xae, 0xe0, 0x00},
    {0xee, 0xea, 0xea, 0xee, 0xee, 0xe0, 0x00, 0x00},
    {0xaa, 0xae, 0xae, 0xee, 0x00, 0x00, 0x00, 0x00},
    {0xee, 0xee, 0xa7, 0xa7, 0xee, 0x00, 0x00, 0x00}}
    ,{{0x7e, 0x7e, 0x7e, 0xee, 0xee, 0xee, 0x00, 0x00},
    {0xaa, 0xaa, 0xee, 0xaa, 0xee, 0x00, 0x00, 0x00},
    {0xaa, 0xaa, 0xa7, 0xae, 0xe0, 0x00, 0x00, 0x00},
    {0xee, 0xe7, 0xee, 0x00, 0x00, 0x00, 0x00, 0x00}}
    //
    ,{{0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0xee, 0xaa},
    {0x00, 0x00, 0x00, 0x00, 0xe0, 0x7e, 0x7e, 0xee},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}}
    ,{{0x00, 0x00, 0x00, 0xe0, 0xae, 0xae, 0xee, 0xaa},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x7e, 0xee},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}}
    //
    ,{{0xaa, 0xee, 0xae, 0xae, 0xe0, 0x00, 0x00, 0x00},
    {0xee, 0x7e, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}}
    ,{{0xaa, 0xee, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0xee, 0x7e, 0x7e, 0xe0, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}}
    };

    uint8_t palettes[1][16][3] = {{{0xff, 0xff, 0xff}, {0xd7, 0xd7, 0xd7}, {0x00, 0x00, 0xff}, {0x00, 0xff, 0x00}, {0x00, 0xc8, 0x00}, {0x00, 0x64, 0x00}, {0x96, 0x96, 0x4b}, {0xff, 0x00, 0x00}, {0xff, 0xc6, 0xc6}, {0x8c, 0x8c, 0xff}, {0xff, 0x96, 0x64}, {0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xFF}, {0x00, 0x00, 0x00}, {0xFF, 0xFF, 0xFF}}};
    
    int k;
    
    for(k = 0; k < 23; k++){
        Tile tile = GPU_newTile(tiles[k]);
        GPU_loadTile(gpu, &tile, k, 1);
    }
    for(k = 0; k < 1; k++){
        Palette palette = GPU_newPalette(palettes[k]);
        GPU_loadPalette(gpu, &palette, k, 1);
    }
    
    GPU_loadMap(gpu, &tilesMap[0][0], 40, 40);
    int aa = 9;
    int bb = -1;
    dd = 0;
    uint8_t cc = 0;
    
    uint8_t camino =  GPU_addStatic(gpu, 0, 1, 0, 0, 1);
    uint8_t mar =     GPU_addStatic(gpu, 1, 4, 10, 0, 0);
    uint8_t hierva =  GPU_addStatic(gpu, 4, 1, 0, 0, 1);
    uint8_t piedra1 = GPU_addStatic(gpu, 5, 1, 0, 0, 0);
    uint8_t piedra2 = GPU_addStatic(gpu, 6, 1, 0, 0, 0);
    uint8_t piedra3 = GPU_addStatic(gpu, 7, 1, 0, 0, 0);
    uint8_t piedra4 = GPU_addStatic(gpu, 8, 1, 0, 0, 0);
    uint8_t flor =    GPU_addStatic(gpu, 9, 2, 6, hierva, 1);
    uint8_t player1 = GPU_addSprite(gpu, 11, 2, 10, 4);
    uint8_t player2 = GPU_addSprite(gpu, 13, 2, 11, 4);
    uint8_t player3 = GPU_addSprite(gpu, 15, 2, 10, 5);
    uint8_t player4 = GPU_addSprite(gpu, 17, 2, 11, 5);
    uint8_t player5 = GPU_addSprite(gpu, 19, 2, 10, 6);
    uint8_t player6 = GPU_addSprite(gpu, 21, 2, 11, 6);
    
    gpu->tableDrawables.drawables[mar].infoAnim.tile[3] = 2;
    
    while(1){
        GPU_spriteMove(gpu, player1, aa, 4);
        GPU_spriteMove(gpu, player2, aa+1, 4);
        GPU_spriteMove(gpu, player3, aa, 5);
        GPU_spriteMove(gpu, player4, aa+1, 5);
        GPU_spriteMove(gpu, player5, aa, 6);
        GPU_spriteMove(gpu, player6, aa+1, 6);
        GPU_draw(gpu);
        if(aa == 2){
            bb = 1;
            aa+= bb;
            //dd = 1;
            gpu->tableDrawables.drawables[player1].infoAnim.view = gpu->tableDrawables.drawables[player1].infoAnim.next[gpu->tableDrawables.drawables[player1].infoAnim.view];
            gpu->tableDrawables.drawables[player1].tile = &gpu->tiles[gpu->tableDrawables.drawables[player1].infoAnim.tile[gpu->tableDrawables.drawables[player1].infoAnim.view]];
            gpu->tableDrawables.drawables[player2].infoAnim.view = gpu->tableDrawables.drawables[player2].infoAnim.next[gpu->tableDrawables.drawables[player2].infoAnim.view];
            gpu->tableDrawables.drawables[player2].tile = &gpu->tiles[gpu->tableDrawables.drawables[player2].infoAnim.tile[gpu->tableDrawables.drawables[player2].infoAnim.view]];
            gpu->tableDrawables.drawables[player3].infoAnim.view = gpu->tableDrawables.drawables[player3].infoAnim.next[gpu->tableDrawables.drawables[player3].infoAnim.view];
            gpu->tableDrawables.drawables[player3].tile = &gpu->tiles[gpu->tableDrawables.drawables[player3].infoAnim.tile[gpu->tableDrawables.drawables[player3].infoAnim.view]];
            gpu->tableDrawables.drawables[player4].infoAnim.view = gpu->tableDrawables.drawables[player4].infoAnim.next[gpu->tableDrawables.drawables[player4].infoAnim.view];
            gpu->tableDrawables.drawables[player4].tile = &gpu->tiles[gpu->tableDrawables.drawables[player4].infoAnim.tile[gpu->tableDrawables.drawables[player4].infoAnim.view]];
            gpu->tableDrawables.drawables[player5].infoAnim.view = gpu->tableDrawables.drawables[player5].infoAnim.next[gpu->tableDrawables.drawables[player5].infoAnim.view];
            gpu->tableDrawables.drawables[player5].tile = &gpu->tiles[gpu->tableDrawables.drawables[player5].infoAnim.tile[gpu->tableDrawables.drawables[player5].infoAnim.view]];
            gpu->tableDrawables.drawables[player6].infoAnim.view = gpu->tableDrawables.drawables[player6].infoAnim.next[gpu->tableDrawables.drawables[player6].infoAnim.view];
            gpu->tableDrawables.drawables[player6].tile = &gpu->tiles[gpu->tableDrawables.drawables[player6].infoAnim.tile[gpu->tableDrawables.drawables[player6].infoAnim.view]];
        }
        if(aa == 10){
            bb = -1;
            aa+= bb;
            //dd = -1;
            gpu->tableDrawables.drawables[player1].infoAnim.view = gpu->tableDrawables.drawables[player1].infoAnim.next[gpu->tableDrawables.drawables[player1].infoAnim.view];
            gpu->tableDrawables.drawables[player1].tile = &gpu->tiles[gpu->tableDrawables.drawables[player1].infoAnim.tile[gpu->tableDrawables.drawables[player1].infoAnim.view]];
            gpu->tableDrawables.drawables[player2].infoAnim.view = gpu->tableDrawables.drawables[player2].infoAnim.next[gpu->tableDrawables.drawables[player2].infoAnim.view];
            gpu->tableDrawables.drawables[player2].tile = &gpu->tiles[gpu->tableDrawables.drawables[player2].infoAnim.tile[gpu->tableDrawables.drawables[player2].infoAnim.view]];
            gpu->tableDrawables.drawables[player3].infoAnim.view = gpu->tableDrawables.drawables[player3].infoAnim.next[gpu->tableDrawables.drawables[player3].infoAnim.view];
            gpu->tableDrawables.drawables[player3].tile = &gpu->tiles[gpu->tableDrawables.drawables[player3].infoAnim.tile[gpu->tableDrawables.drawables[player3].infoAnim.view]];
            gpu->tableDrawables.drawables[player4].infoAnim.view = gpu->tableDrawables.drawables[player4].infoAnim.next[gpu->tableDrawables.drawables[player4].infoAnim.view];
            gpu->tableDrawables.drawables[player4].tile = &gpu->tiles[gpu->tableDrawables.drawables[player4].infoAnim.tile[gpu->tableDrawables.drawables[player4].infoAnim.view]];
            gpu->tableDrawables.drawables[player5].infoAnim.view = gpu->tableDrawables.drawables[player5].infoAnim.next[gpu->tableDrawables.drawables[player5].infoAnim.view];
            gpu->tableDrawables.drawables[player5].tile = &gpu->tiles[gpu->tableDrawables.drawables[player5].infoAnim.tile[gpu->tableDrawables.drawables[player5].infoAnim.view]];
            gpu->tableDrawables.drawables[player6].infoAnim.view = gpu->tableDrawables.drawables[player6].infoAnim.next[gpu->tableDrawables.drawables[player6].infoAnim.view];
            gpu->tableDrawables.drawables[player6].tile = &gpu->tiles[gpu->tableDrawables.drawables[player6].infoAnim.tile[gpu->tableDrawables.drawables[player6].infoAnim.view]];
        }
        if(cc % 4 == 0)
            aa+= bb;
        cc++;
        
        GPU_scroll(gpu, 0, dd);
        dd = 0;
    }
    
    
    /*
    uint8_t techo1[4][8] ={{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x33, 0x33, 0x33, 0x33},
                           {0x00, 0x00, 0x33, 0x33, 0x33, 0x33, 0x44, 0x44}};
    
    uint8_t techo2[4][8] ={{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33},
                           {0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44}};
    
    uint8_t techo3[4][8] ={{0x00, 0x00, 0x33, 0x33, 0x33, 0x33, 0x44, 0x44},
                           {0x00, 0x00, 0x33, 0x33, 0x33, 0x33, 0x44, 0x44},
                           {0x00, 0x00, 0x33, 0x33, 0x33, 0x33, 0x44, 0x44},
                           {0x00, 0x00, 0x33, 0x33, 0x33, 0x33, 0x44, 0x44}};
    
    uint8_t techo4[4][8] ={{0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x22, 0x22},
                           {0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x22, 0x22},
                           {0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x22, 0x22},
                           {0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x22, 0x22}};
    
    uint8_t techo5[4][8] ={{0x00, 0x00, 0x33, 0x33, 0x33, 0x33, 0x22, 0x22},
                           {0x00, 0x00, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33},
                           {0x00, 0x00, 0x33, 0x33, 0x44, 0x44, 0x22, 0x22},
                           {0x00, 0x00, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33}};
    
    uint8_t techo6[4][8] ={{0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22},
                           {0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33},
                           {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22},
                           {0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33}};
    
    uint8_t techo7[4][8] ={{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x00, 0x00},
                           {0x44, 0x44, 0x44, 0x44, 0x33, 0x33, 0x33, 0x33}};
    
    uint8_t techo8[4][8] ={{0x11, 0x11, 0x11, 0x22, 0x33, 0x33, 0x33, 0x33},
                           {0x11, 0x11, 0x11, 0x22, 0x33, 0x33, 0x33, 0x33},
                           {0x11, 0x11, 0x11, 0x22, 0x33, 0x33, 0x33, 0x33},
                           {0x11, 0x11, 0x11, 0x22, 0x33, 0x33, 0x33, 0x33}};
    
    uint8_t techo9[4][8] ={{0x22, 0x22, 0x22, 0x22, 0x33, 0x33, 0x33, 0x33},
                           {0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33},
                           {0x22, 0x22, 0x22, 0x22, 0x44, 0x44, 0x33, 0x33},
                           {0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33}};
    
    uint8_t suelo1[4][8] ={{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x55, 0x55, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}};
    
    uint8_t suelo2[4][8] ={{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x55, 0x55},
                           {0x55, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}};
    
    uint8_t suelo3[4][8] ={{0x55, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x55, 0x55, 0x00, 0x00, 0x00, 0x00}};
    
    uint8_t suelo4[4][8] ={{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x55, 0x55},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}};
    
    uint8_t casa1[4][8] = {{0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x33, 0x33},
                           {0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x33, 0x33},
                           {0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x33, 0x33},
                           {0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x33, 0x33}};
    
    uint8_t casa2[4][8] = {{0x77, 0x77, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77}};
    
    uint8_t casa3[4][8] = {{0x77, 0x77, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x66, 0x66, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66}};
    
    uint8_t casa4[4][8] = {{0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x33, 0x33},
                           {0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66},
                           {0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66},
                           {0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66}};
    
    uint8_t casa5[4][8] = {{0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66},
                           {0x33, 0x33, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66},
                           {0x66, 0x66, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66}};
    
    uint8_t casa6[4][8] = {{0x66, 0x66, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x66, 0x66},
                           {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x66, 0x66}};
    
    uint8_t casa7[4][8] = {{0x66, 0x66, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77}};
    
    uint8_t casa8[4][8] = {{0x66, 0x66, 0x77, 0x77, 0x66, 0x66, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66}};
    
    uint8_t casa9[4][8] = {{0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66},
                           {0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66}};
    
    uint8_t casa10[4][8] ={{0x77, 0x77, 0x66, 0x66, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x66, 0x66, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x66, 0x66, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x66, 0x66, 0x77, 0x77, 0x77, 0x77}};
    
    uint8_t casa11[4][8] ={{0x77, 0x77, 0x66, 0x66, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x66, 0x66, 0x77, 0x77, 0x77, 0x77},
                           {0x77, 0x77, 0x66, 0x66, 0x77, 0x77, 0x77, 0x66},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66}};
    
    uint8_t casa12[4][8] ={{0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x33, 0x33},
                           {0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x66, 0x66},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66}};
    
    uint8_t casa13[4][8] ={{0x33, 0x33, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00},
                           {0x33, 0x33, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00},
                           {0x33, 0x33, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00},
                           {0x33, 0x33, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00}};
    
    uint8_t casa14[4][8] ={{0x33, 0x33, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00},
                           {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00}};
    
    uint8_t nulo[4][8] =  {{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                           {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}};
    
    */
    return;
}

void _DefaultInterrupt(void){
    IFS0bits.INT0IF = 0;
    dd++;
}
